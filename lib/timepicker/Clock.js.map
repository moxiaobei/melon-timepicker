{"version":3,"sources":["timepicker/Clock.js"],"names":["cx","PI","Math","atan","TimePickerClock","props","onTimeChange","bind","onMouseDown","onMouseUp","onMouseChange","handler","clearTimeout","mouseChangeTimer","setTimeout","e","shouldComponentUpdate","nextProps","time","mode","begin","end","isSame","componentWillUnmount","onChange","refs","main","document","pageX","pageY","mainPosition","radius","width","pos","x","left","y","top","console","log","deg","single","number","round","getHours","toDate","renderItems","items","map","timeMoment","selected","hour","itemHour","minute","disabled","isBefore","isAfter","render","className","addVariants","build","getPartClassName","displayName","propTypes","instanceOf","Date","oneOf","func","isRequired"],"mappings":"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","file":"timepicker/Clock.js","sourcesContent":["/**\n * @file melon/TimePickerClock\n * @author cxtom(cxtom2008@qq.com)\n */\n\nimport React, {Component, PropTypes} from 'react';\nimport moment from 'moment';\n\nimport {create} from 'melon-core/classname/cxBuilder';\nimport {range} from 'melon-core/util/array';\nimport {\n    getPosition,\n    on,\n    off\n} from 'melon/common/util/dom';\n\nimport ClockItem from './ClockItem';\nimport ClockHand from './ClockHand';\n\nconst cx = create('TimePickerClock');\nconst {\n    PI,\n    atan\n} = Math;\n\nexport default class TimePickerClock extends Component {\n\n    constructor(props) {\n        super(props);\n\n        this.onTimeChange = this.onTimeChange.bind(this);\n        this.onMouseDown = this.onMouseDown.bind(this);\n        this.onMouseUp = this.onMouseUp.bind(this);\n\n        this.onMouseChange = (() => {\n\n            let handler = this.onMouseChange;\n\n            return e => {\n                clearTimeout(this.mouseChangeTimer);\n                this.mouseChangeTimer = setTimeout(handler.bind(this, e), 5);\n            };\n\n        })();\n    }\n\n    shouldComponentUpdate(nextProps) {\n\n        const {\n            time,\n            mode,\n            begin,\n            end\n        } = this.props;\n\n        return !moment(time).isSame(nextProps.time)\n            || mode !== nextProps.mode\n            || !moment(begin).isSame(nextProps.begin)\n            || !moment(end).isSame(nextProps.end);\n    }\n\n    componentWillUnmount() {\n        clearTimeout(this.mouseChangeTimer);\n        this.mouseChangeTimer = null;\n    }\n\n    onTimeChange({time}) {\n        this.props.onChange({time});\n    }\n\n    onMouseDown(e) {\n\n        if (this.props.mode === 'minute') {\n            on(this.refs.main, 'mousemove', this.onMouseChange);\n            on(document, 'mouseup', this.onMouseUp);\n        }\n        else {\n            on(this.refs.main, 'mouseup', this.onMouseChange);\n        }\n    }\n\n    onMouseUp(e) {\n\n        if (this.props.mode === 'minute') {\n            this.onMouseChange(e);\n            off(this.refs.main, 'mousemove', this.onMouseChange);\n            off(document, 'mouseup', this.onMouseUp);\n        }\n        else {\n            off(this.refs.main, 'mouseup', this.onMouseChange);\n        }\n    }\n\n    onMouseChange({pageX, pageY}) {\n\n        const mainPosition = getPosition(this.refs.main);\n        const radius = mainPosition.width / 2;\n\n        const pos = {\n            x: pageX - mainPosition.left - radius,\n            y: pageY - mainPosition.top - radius\n        };\n\n        console.log(pageX, pageY, mainPosition, radius);\n\n        let deg;\n\n        if (pos.y === 0) {\n            return;\n        }\n\n        if (pos.x >= 0 && pos.y < 0) {\n            deg = -180 * atan(pos.x / pos.y) / PI;\n        }\n        else if (pos.x >= 0 && pos.y > 0) {\n            deg = 180 - 180 * atan(pos.x / pos.y) / PI;\n        }\n        else if (pos.x < 0 && pos.y > 0) {\n            deg = 180 - 180 * atan(pos.x / pos.y) / PI;\n        }\n        else if (pos.x < 0 && pos.y < 0) {\n            deg = 360 - 180 * atan(pos.x / pos.y) / PI;\n        }\n\n        const {\n            time,\n            mode\n        } = this.props;\n\n        const single = mode === 'minute' ? 6 : 30;\n        let number = Math.round(deg / single);\n        number = mode === 'hour' && number === 0 ? 12 : number;\n        number = mode === 'hour' && time.getHours() > 12 ? number + 12 : number;\n\n        if (moment(time)[mode](number).isSame(time)) {\n            return;\n        }\n\n        this.onTimeChange({\n            time: moment(time)[mode](number).toDate()\n        });\n\n    }\n\n    renderItems() {\n\n        const {\n            time,\n            mode,\n            begin,\n            end\n        } = this.props;\n\n        const items = mode === 'hour'\n            ? range(1, 13)\n            : range(0, 60, 5);\n\n        return items.map(number => {\n\n            let timeMoment;\n            let selected = false;\n            if (mode === 'hour') {\n                let hour = moment(time).hour();\n                hour = hour === 0 ? 12 : hour;\n                selected = (hour > 12 ? (hour - 12) : hour) === number;\n                const itemHour = hour > 12 ? (number + 12) : number;\n                timeMoment = moment(time).hour(itemHour);\n            }\n            else {\n                selected = moment(time).minute() === number;\n                timeMoment = moment(time).minute(number);\n            }\n\n            let disabled = false;\n            disabled = begin ? timeMoment.isBefore(begin) : false;\n            disabled = end ? timeMoment.isAfter(end) : false;\n\n            return (\n                <ClockItem\n                    key={mode + number}\n                    time={timeMoment.toDate()}\n                    mode={mode}\n                    selected={selected}\n                    disabled={disabled} />\n            );\n        });\n\n    }\n\n    render() {\n\n        const {\n            time,\n            mode\n        } = this.props;\n\n        const className = cx(this.props)\n            .addVariants(mode)\n            .build();\n\n        return (\n            <div className={className}>\n                <div\n                    className={cx.getPartClassName('main')}\n                    ref=\"main\"\n                    onMouseDown={this.onMouseDown}>\n                    <ClockHand\n                        time={time}\n                        mode={mode}\n                        onChange={this.onTimeChange} />\n                    {this.renderItems()}\n                </div>\n            </div>\n        );\n\n    }\n\n}\n\nTimePickerClock.displayName = 'TimePickerClock';\n\nTimePickerClock.propTypes = {\n    time: PropTypes.instanceOf(Date),\n    mode: PropTypes.oneOf(['hour', 'minute']),\n    begin: PropTypes.instanceOf(Date),\n    end: PropTypes.instanceOf(Date),\n    onChange: PropTypes.func.isRequired\n};\n"],"sourceRoot":"/source/"}