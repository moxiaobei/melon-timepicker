{"version":3,"sources":["TimePicker.js"],"names":["cx","TimePicker","props","context","value","state","onLabelClick","bind","onConfirm","onCancel","onTimeChange","time","parseValue","undefined","open","componentDidMount","container","document","createElement","className","part","build","body","appendChild","renderPopup","componentDidUpdate","size","timeFormat","begin","end","popup","render","onFocus","onBlur","componentWillUnmount","unmountComponentAtNode","parentElement","removeChild","getSyncUpdates","nextProps","disabled","readOnly","customValidity","defaultValue","isNaN","getTime","Date","vilidity","stringifyValue","format","date","toDate","e","setState","valueMoment","timeMoment","get","onChange","type","target","name","placeholder","labelFormat","others","validity","addStates","focus","getStyleStates","getPartClassName","displayName","defaultProps","autoConfirm","propTypes","string","bool","labalFormat","oneOfType","object","childContextTypes","contextTypes"],"mappings":"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","file":"TimePicker.js","sourcesContent":["/**\n * @file melon/TimePicker\n * @author cxtom <cxtom2008@gmail.com>\n */\n\nimport React, {PropTypes} from 'react';\nimport moment from 'moment';\nimport ReactDOM from 'react-dom';\n\nimport InputComponent from 'melon-core/InputComponent';\nimport {create} from 'melon-core/classname/cxBuilder';\nimport Validity from 'melon-core/Validity';\nimport {getNextValidity} from 'melon-core/util/syncPropsToState';\n\nimport Icon  from 'melon/Icon';\nimport Confirm from 'melon/Confirm';\nimport Panel from './timepicker/Panel';\n\nconst cx = create('TimePicker');\n\nexport default class TimePicker extends InputComponent {\n\n    constructor(props, context) {\n\n        super(props, context);\n\n        const value = this.state.value;\n\n        this.onLabelClick = this.onLabelClick.bind(this);\n        this.onConfirm = this.onConfirm.bind(this);\n        this.onCancel = this.onCancel.bind(this);\n        this.onTimeChange = this.onTimeChange.bind(this);\n\n        this.state = {\n\n            ...this.state,\n\n            // 缓存用户在 confirm 前的选中值\n            time: value ? this.parseValue(value) : undefined,\n\n            // 是否打开选择窗\n            open: false\n        };\n\n    }\n\n    componentDidMount() {\n\n        super.componentDidMount();\n\n        let container = this.container = document.createElement('div');\n\n        container.className = cx().part('popup').build();\n\n        document.body.appendChild(container);\n        this.renderPopup(this.props);\n    }\n\n    componentDidUpdate() {\n        this.renderPopup(this.props);\n    }\n\n    renderPopup(props) {\n\n        const {\n            size,\n            timeFormat\n        } = props;\n\n        let {begin, end} = props;\n\n        begin = begin ? this.parseValue(begin) : null;\n        end = end ? this.parseValue(end) : null;\n\n        this.popup = ReactDOM.render(\n            <Confirm\n                open={this.state.open}\n                variants={['timepicker']}\n                onConfirm={this.onConfirm}\n                onCancel={this.onCancel}\n                onShow={this.props.onFocus}\n                onHide={this.props.onBlur}\n                size={size}\n                width=\"adaptive\"\n                buttonVariants={['secondery', 'timepicker']} >\n                <Panel\n                    time={this.state.time}\n                    begin={begin}\n                    end={end}\n                    format={timeFormat}\n                    onChange={this.onTimeChange} />\n            </Confirm>,\n            this.container\n        );\n    }\n\n    componentWillUnmount() {\n\n        let container = this.container;\n\n        if (container) {\n            ReactDOM.unmountComponentAtNode(container);\n            container.parentElement.removeChild(container);\n            this.container = container = null;\n        }\n    }\n\n    getSyncUpdates(nextProps) {\n\n        const {disabled, readOnly, customValidity, defaultValue} = nextProps;\n\n        let value = nextProps.value == null ? defaultValue : nextProps.value;\n\n        // 如果有值，那么就试着解析一下；否则设置为 null\n        let time = value ? this.parseValue(value) : null;\n\n        // 如果 time 为 null 或者是 invalid time，那么就用上默认值；\n        // 否则就用解析出来的这个值\n        time = !time || isNaN(time.getTime()) ? new Date() : time;\n\n        const vilidity = getNextValidity(this, {value, disabled, customValidity});\n\n        return {\n            time,\n            vilidity,\n            value: disabled || readOnly || !value ? value : this.stringifyValue(time)\n        };\n\n    }\n\n    /**\n     * 格式化日期\n     *\n     * @param {Date} time 源日期对象\n     * @param {string=} format 日期格式，默认为当前实例的timeFormat\n     * @return {string} 格式化后的日期字符串\n     * @private\n     */\n    stringifyValue(time) {\n\n        if (typeof time === 'string') {\n            return time;\n        }\n\n        const timeFormat = this.props.timeFormat;\n\n        return moment(time).format(timeFormat);\n    }\n\n    /**\n     * 格式化日期对象\n     *\n     * @param  {string} date 日期字符串\n     * @return {Date}        转化后的日期对象\n     * @private\n     */\n    parseValue(date) {\n\n        if (typeof date !== 'string') {\n            return date;\n        }\n\n        return moment(date, this.props.timeFormat).toDate();\n    }\n\n\n    onLabelClick(e) {\n\n        const {disabled, readOnly} = this.props;\n\n        if (disabled || readOnly) {\n            return;\n        }\n\n        this.setState({open: true});\n\n    }\n\n    /**\n     * rawValue 在 TimePicker Dialog上点击确定或取消按钮触发\n     *\n     * @private\n     */\n    onConfirm() {\n\n        let {value, time} = this.state;\n\n        value = this.parseValue(value);\n\n        const valueMoment = moment(value, this.timeFormat);\n        const timeMoment = moment(time);\n\n        if (value !== '' && valueMoment.get('hour') === timeMoment.get('hour')\n            && valueMoment.get('minute') === timeMoment.get('minute')) {\n            this.setState({open: false});\n        }\n\n        this.setState({open: false}, () => {\n\n            super.onChange({\n                type: 'change',\n                target: this,\n                value: this.stringifyValue(time)\n            });\n\n        });\n\n    }\n\n    onCancel() {\n        this.setState({open: false});\n    }\n\n    onTimeChange({time}) {\n        this.setState({time});\n    }\n\n    render() {\n\n        const {\n            state,\n            props\n        } = this;\n\n        const {\n            disabled,\n            readOnly,\n            name,\n            placeholder,\n            timeFormat,\n            labelFormat,\n            ...others\n        } = props;\n\n        const {value, validity} = state;\n\n        const open = state.open;\n        const className = cx(props)\n            .addStates({focus: open})\n            .addStates(this.getStyleStates())\n            .build();\n\n        return (\n            <div {...others} className={className}>\n                <input\n                    name={name}\n                    ref=\"input\"\n                    type=\"hidden\"\n                    value={value}\n                    disabled={disabled} />\n                <label\n                    onClick={(disabled || readOnly) ? null : this.onLabelClick}\n                    className={cx.getPartClassName('label')}>\n                    {value ? moment(value, timeFormat).format(labelFormat) : (\n                        <span className={cx.getPartClassName('label-placeholder')}>\n                            {placeholder}\n                        </span>\n                    )}\n                    <Icon icon='expand-more' />\n                </label>\n                <Validity validity={validity} />\n            </div>\n        );\n\n    }\n}\n\nTimePicker.displayName = 'TimePicker';\n\nTimePicker.defaultProps = {\n    ...InputComponent.defaultProps,\n    defaultValue: '',\n    timeFormat: 'HH:mm:ss',\n    labelFormat: 'HH:mm',\n    placeholder: '请选择',\n    autoConfirm: false\n};\n\nTimePicker.propTypes = {\n    ...InputComponent.propTypes,\n    value: PropTypes.string,\n    autoConfirm: PropTypes.bool,\n    timeFormat: PropTypes.string,\n    labalFormat: PropTypes.string,\n    end: PropTypes.oneOfType([\n        PropTypes.object,\n        PropTypes.string\n    ]),\n    begin: PropTypes.oneOfType([\n        PropTypes.object,\n        PropTypes.string\n    ])\n};\n\nTimePicker.childContextTypes = InputComponent.childContextTypes;\nTimePicker.contextTypes = InputComponent.contextTypes;\n"]}